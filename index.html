<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Ping Pong AR sin Zoom</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.min.js"></script>
    <style>
      body { margin: 0; overflow: hidden; }
    </style>
  </head>
  <body>
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
      
      <!-- Marcador personalizado -->
      <a-marker type="pattern" url="miimagen.patt">
        <!-- Contenedor para alejar visualmente el juego del marcador -->
        <a-entity id="contenedor" position="0 0 -1.5">
          
          <!-- Pelota -->
          <a-sphere id="pelota" position="0 0.2 0" radius="0.1" color="red"></a-sphere>

          <!-- Pala controlada por el jugador -->
          <a-box id="pala" position="0 -0.2 0" depth="0.05" height="0.05" width="0.4" color="blue"></a-box>
          
        </a-entity>
      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>

    <script>
      const escena = document.querySelector('a-scene');
      const pelota = document.querySelector('#pelota');
      const pala = document.querySelector('#pala');

      // Velocidad inicial
      let velocidad = new THREE.Vector3(0.015, 0.015, 0);
      let reboteActivo = false;

      // Movimiento de la pelota
      function moverPelota() {
        // Obtener posición actual
        const pos = pelota.object3D.position;

        // Rebotar en los bordes (X)
        if (pos.x > 0.7 || pos.x < -0.7) velocidad.x *= -1;

        // Rebotar en los bordes (Y)
        if (pos.y > 0.5) velocidad.y *= -1;

        // Colisión con la pala
        const distancia = pos.distanceTo(pala.object3D.position);
        if (distancia < 0.2 && !reboteActivo) {
          velocidad.y *= -1;
          reboteActivo = true;
        }

        // Resetear rebote cuando se aleja
        if (distancia >= 0.2) reboteActivo = false;

        // Mover la pelota
        pos.add(velocidad);
      }

      // Mover la pala al tocar la pantalla
      escena.addEventListener('touchstart', function (event) {
        const touchX = event.touches[0].clientX;
        const pantallaAncho = window.innerWidth;
        const x = ((touchX / pantallaAncho) - 0.5) * 1.4; // rango aprox. -0.7 a 0.7
        pala.setAttribute('position', `${x} -0.2 0`);
      });

      // Animación constante
      function animar() {
        moverPelota();
        requestAnimationFrame(animar);
      }

      animar();
    </script>
  </body>
</html>
